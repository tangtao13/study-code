<!--
 * @Author: myname
 * @Date: 2021-05-31 11:01:30
 * @LastEditors: Do not edit
 * @LastEditTime: 2021-05-31 16:30:48
-->

### Cookie

###### 目录

1. 概述  
   Cookie 是服务器保存在浏览器的一小段文本信息，一般大小不能超过 4KB。浏览器每次向服务器发出请求，  
   就会自动附上这段信息。  
   Cookie 主要保存状态信息，以下是一些主要用途:

    - 对话（session）管理：保存登录、购物车等需要记录的信息。
    - 个性化信息：保存用户的偏好，比如网页的字体大小、背景色等等。
    - 追踪用户：记录和分析用户行为。

2. Cookie 与 HTTP 协议
    - HTTP 回应: Cookie 的生成
    - HTTP 的请求: Cookie 的发送
3. Cookie 的属性
    - Expires, Max-Age
    - Domain, Path
    - Secure, HttpOnly
    - SameSite
4. document.cookie

### XMLHttpRequest

```javascript
let xhr = new XMLHttpRequest();
xhr.onreadystatechange = function () {
    if (xhr.readyState === 4) {
        if (xhr.status === 200) {
            console.log(xhr.responseText);
        } else {
            console.error(xhr.statusText);
        }
    }
};
xhr.onerror = function (e) {
    console.error(xhr.statusText);
};
xhr.open('GET', '/endpoint', true);
xhr.send(null);

//Blob
var droptarget = document.getElementById('droptarget');

droptarget.ondrop = function (e) {
    var files = e.dataTransfer.files;
    for (var i = 0; i < files.length; i++) {
        var type = files[i].type;
        if (type.substring(0, 6) !== 'image/') continue;
        var img = document.createElement('img');
        img.src = URL.createObjectURL(files[i]);
        img.onload = function () {
            this.width = 100;
            document.body.appendChild(this);
            URL.revokeObjectURL(this.src);
        };
    }
};

// HTML 代码如下
// <input type="file" onchange="readfile(this.files[0])"></input>
// <pre id="output"></pre>
function readfile(f) {
    var reader = new FileReader();
    reader.readAsText(f);
    reader.onload = function () {
        var text = reader.result;
        var out = document.getElementById('output');
        out.innerHTML = '';
        out.appendChild(document.createTextNode(text));
    };
    reader.onerror = function (e) {
        console.log('Error', e);
    };
}

// HTML 代码如下
// <input type="file" onchange="typefile(this.files[0])"></input>
function typefile(file) {
    // 文件开头的四个字节，生成一个 Blob 对象
    var slice = file.slice(0, 4);
    var reader = new FileReader();
    // 读取这四个字节
    reader.readAsArrayBuffer(slice);
    reader.onload = function (e) {
        var buffer = reader.result;
        // 将这四个字节的内容，视作一个32位整数
        var view = new DataView(buffer);
        var magic = view.getUint32(0, false);
        // 根据文件的前四个字节，判断它的类型
        switch (magic) {
            case 0x89504e47:
                file.verified_type = 'image/png';
                break;
            case 0x47494638:
                file.verified_type = 'image/gif';
                break;
            case 0x25504446:
                file.verified_type = 'application/pdf';
                break;
            case 0x504b0304:
                file.verified_type = 'application/zip';
                break;
        }
        console.log(file.name, file.verified_type);
    };
}
```
