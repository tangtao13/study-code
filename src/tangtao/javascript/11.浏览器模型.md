<!--
 * @Author: myname
 * @Date: 2021-05-31 08:22:36
 * @LastEditors: Do not edit
 * @LastEditTime: 2021-05-31 09:46:00
-->

### 浏览器环境概述

JavaScript 是浏览器的内置脚本语言。浏览器内置了 JavaScript 引擎，并提供各种接口，让 JavaScript 脚本可以  
控制浏览器的各种功能。一旦网页内嵌了 JavaScript 脚本，浏览器加载网页，就会去执行脚本，从而达到操作浏览器的  
目的，实现网页的各种动态效果。

###### 目录

1. 代码嵌入网页的方法
    - script 元素嵌入代码
    - script 元素加载外部脚本
    - 事件属性
    - URL 协议
2. script 元素

    - 工作原理
    - defer 属性
    - async 属性
    - 脚本的动态加载

        ```javascript
        //脚本的动态加载
        function loadScript(src, done) {
            const js = document.createElement('script');
            js.src = src;
            js.onload = function (e) {
                done(null, e);
            };

            js.onerror = function () {
                done(new Error('加载失败'), {});
            };
            document.head.appendChild(js);
        }
        ```

    - 加载使用的协议

3. 浏览器的组成

    - 渲染引擎
        - 主要作用是将网页代码渲染为用户视觉可以感知的平面文档。
        - 不同的浏览器有不同的渲染引擎：
            - FireFox: Gecko 引擎
            - Safari: WebKit 引擎
            - Chrome: Blink 引擎
            - IE: Trident 引擎
            - Edge: EdgeHTML 引擎
        - 渲染引擎处理网页，通常有 4 个阶段
            - 解析代码: HTML 代码解析为 DOM，CSS 代码解析为 CSSOM（CSS Object Model）
            - 对象合成：将 DOM 和 CSSOM 合并成一棵渲染树（render tree）
            - 布局： 计算出渲染树的布局（layout）
            - 绘制： 将渲染树绘制到屏幕
    - 重流和重绘  
       渲染树转换成网页布局，称为“布局流”（flow）；布局显示到页面的过程称为“绘制”(paint)。  
       他们都有阻塞效应，并且会耗费很多时间和计算资源。  
       页面生成以后，脚本操作和样式表操作，都会触发“重流”（reflow）和“重绘”(repaint)。用户的互动也会触发重流和重绘。

        优化技巧：

        - 读取 DOM 或者写入 DOM，尽量写在一起，不要混杂。
        - 缓存 DOM 信息
        - 不要一项一项的改变样式，而是使用 CSS class 一次性的改变样式
        - 使用 documentFragment 操作 DOM
        - 动画使用 absolute 定位或者 fixed 定位，这样可以减少对其他元素的影响
        - 只有在必要时才显示影藏元素
        - 使用 window.requestAnimationFrame()，因为它可以把代码推迟到下一次重绘之前执行，而不是立即要求页面重绘
        - 使用虚拟 DOM（Virtual DOM） 库

        ```javascript
        // 重绘代价低
        function doubleHeight(element) {
            var currentHeight = element.clientHeight;

            window.requestAnimationFrame(function () {
                element.style.height = currentHeight * 2 + 'px';
            });
        }

        all_my_elements.forEach(doubleHeight);
        ```

    - JavaScript 引擎  
      作用： 读取网页中的 JavaScript 代码，对其处理后运行

### window 对象

###### 目录
